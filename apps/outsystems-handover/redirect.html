<!DOCTYPE html>
<html>

<head>
    <title>Redirecting...</title>
</head>

<body>
    <script>
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);

        // Flow 2: Check if cms-modern-token is present (redirected back from foo.com)
        const cmsModernToken = urlParams.get('cms-modern-token');
        if (cmsModernToken) {
            // Set localStorage value
            localStorage.setItem('foo', cmsModernToken);

            // Get nextR parameter and redirect
            const nextR = urlParams.get('nextR');
            if (nextR) {
                window.location.href = nextR;
            }
        } else {
            // Flow 1: Check for r and cc parameters
            const r = urlParams.get('r');
            const cc = urlParams.get('cc');

            if (r && cc) {
                const redirectUrl = `https://foo.com?r=${encodeURIComponent(window.location.href)}&cc=${encodeURIComponent(cc)}&nextR=${encodeURIComponent(r)}`;

                // Redirect to foo.com
                window.location.href = redirectUrl;
            }
        }
    </script>
</body>

</html>
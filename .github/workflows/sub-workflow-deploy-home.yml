name: "Internal: sub-workflow: deploy home"

on:
  workflow_call:
    secrets:
      BLOB_STORAGE_CONNECTION_STRING:
        required: true

permissions:
  contents: read

jobs:
  deploy-home:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v5

      - uses: azure/cli@v2.2.0 # pinned to minor version whilst MS fix https://github.com/azure/azure-cli/issues/32039
        with:
          azcliversion: latest
          inlineScript: |
            az storage blob delete-batch \
                --source '$web' \
                --pattern "home/*" \
                --connection-string "${{ secrets.BLOB_STORAGE_CONNECTION_STRING }}"

            az storage blob upload-batch \
              --destination "\$web/home" \
              --source "./apps/home" \
              --connection-string "${{ secrets.BLOB_STORAGE_CONNECTION_STRING }}"

services:
  nginx:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    ports:
      - "8080:80"
    volumes:
      # Mount config files for live reload during development
      - ../config/global-components.conf:/etc/nginx/templates/global-components.conf:ro
      - ../config/global-components.js:/etc/nginx/templates/global-components.js:ro
      # Use test vars that point to mock-upstream
      - ./global-components-vars.test.js:/etc/nginx/templates/global-components-vars.js:ro
    depends_on:
      - mock-upstream

  mock-upstream:
    build:
      context: .
      dockerfile: Dockerfile.mock
    ports:
      - "3000:3000"
